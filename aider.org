* Aider

Key configurations:

- Securely retrieve API keys from auth-source
- Set environment variables for OpenAI and Anthropic
- Configure Aider to use the Sonnet model
- Disable company-mode in Aider buffers for better interaction

Comint-mode is a general purpose mode for command interpreters. It's used by Aider for its interactive buffer, providing features like command history and input editing.

[[https://aider.chat/2025/01/24/r1-sonnet.html][R1 as architect with Sonnet as editor has set a new SOTA of 64.0% on the aider polyglot benchmark]]. It's also cheaper than using Sonnet alone (at least without OpenRouter).

#+begin_src elisp :tangle no
(use-package! aider
  :after doom auth-source
  :config
  ;; Securely retrieve API keys from auth-source
  (let ((openai-key (auth-source-pick-first-password :host "api.openai.com" :user "apikey"))
        (anthropic-key (auth-source-pick-first-password :host "api.anthropic.com" :user "apikey"))
        (openrouter-key (auth-source-pick-first-password :host "openrouter.ai" :user "apikey")))
    ;; Set environment variables for API access
    (when openai-key
      (setenv "OPENAI_API_KEY" openai-key))
    (when anthropic-key
      (setenv "ANTHROPIC_API_KEY" anthropic-key))
    (when openrouter-key
      (setenv "OPENROUTER_API_KEY" openrouter-key)))

  (setq aider-args '("--architect" "--model" "openrouter/deepseek/deepseek-r1" "--editor-model" "openrouter/anthropic/claude-3.5-sonnet"))

  ;; Disable company-mode in aider buffers to prevent interference
  (add-hook! 'comint-mode-hook
    (defun +aider-disable-company-h ()
      (when (string-match-p "\\*aider:" (buffer-name))
        (company-mode -1)))))
#+end_src