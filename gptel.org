* Gptel

Simplified [[https://github.com/karthink/gptel][GPTel]] configuration with Anthropic as primary provider.

#+begin_src elisp
(use-package! gptel
  :commands (gptel gptel-add gptel-rewrite gptel-menu gptel-send)
  :init
  (setq gptel-use-curl "/opt/homebrew/opt/curl/bin/curl")
  :config
  (gptel-make-anthropic "claude-thinking"
    :stream t
    :models '(claude-sonnet-4-20250514)
    :request-params '(:thinking (:type "enabled" :budget_tokens 2048)
                      :max_tokens 4096))

  (setenv "AWS_PROFILE" "claude-bedrock")
  (gptel-make-bedrock "claude-bedrock"
    :stream t
    :region "eu-south-2"
    :models '(claude-sonnet-4-20250514)
    :model-region 'eu)

  (setq gptel-model 'claude-sonnet-4-20250514
        gptel-backend (gptel-make-anthropic "Claude" :stream t))

  (setq! gptel-default-mode 'org-mode)

  (setq! gptel-prompt-prefix-alist
         '((markdown-mode . "# Prompt\n\n")
           (org-mode . "* Prompt\n\n")))

  (setq! gptel-response-prefix-alist
         '((markdown-mode . "# Response\n\n")
           (org-mode . "* Response\n\n")))

  (map! :map gptel-mode-map
        "C-c C-c" #'gptel-send))

(map! :leader
      (:prefix ("j" . "ai")
       :desc "Open chat" "c" #'gptel
       :desc "Add file/buffer to context" "a" #'gptel-add
       :desc "Rewrite/Refactor" "r" #'gptel-rewrite
       :desc "Open menu" "m" #'gptel-menu
       :desc "Submit prompt" "j" #'gptel-send))
#+end_src

